description: >
  Example of how to use the TacoTruck submit command to upload test results.
  This example shows how to install TacoTruck CLI, run tests, and submit results.
usage:
  version: 2.1
  orbs:
    tacotruck: testfiesta/tacotruck@<<pipeline.parameters.dev-orb-version>>
  workflows:
    test-and-submit:
      jobs:
        - test-and-submit-results:
            executor: tacotruck/default
            parameters:
              api_key:
                type: env_var_name
                default: TESTFIESTA_API_KEY
            steps:
              - checkout
              - tacotruck/install:
                  version: "latest"
              - run:
                  name: Create sample test results
                  command: |
                    mkdir -p ./test-results
                    cat > ./test-results/junit.xml \<< 'EOF'
                    <?xml version="1.0" encoding="UTF-8"?>
                    <testsuites name="Sample Test Suite" tests="3" failures="1" errors="0" time="0.5">
                      <testsuite name="ExampleTests" tests="3" failures="1" errors="0" time="0.5">
                        <testcase name="test_success" classname="ExampleTests" time="0.1"/>
                        <testcase name="test_failure" classname="ExampleTests" time="0.2">
                          <failure message="Expected true but got false">AssertionError: Expected true but got false</failure>
                        </testcase>
                        <testcase name="test_another_success" classname="ExampleTests" time="0.2"/>
                      </testsuite>
                    </testsuites>
                    EOF
              - tacotruck/submit:
                  provider: "testfiesta"
                  results_path: "./test-results/junit.xml"
                  project_key: "my-project-key"
                  api_key: <<parameters.api_key>>
                  handle: "ORG_1"
                  run_name: "CircleCI Test Run"
                  base_url: "https://api.testfiesta.com"
